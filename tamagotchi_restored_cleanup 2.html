<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Tamagotchi with Inventory Refill</title>
  <style>
    @font-face {
      font-family: "8bit";
      src: url("https://fonts.cdnfonts.com/s/18139/PressStart2P-Regular.woff") format("woff");
    }
    body {
      margin:0; padding:0;
      background:#0d1117;
      display:flex; flex-direction:column; align-items:center;
      color:white; font-family:"8bit", Arial, sans-serif;
    }
    .meters-container, .inventory { width:90%; max-width:400px; margin-top:10px; }
    .meter, .inventory-section { display:flex; align-items:center; margin-bottom:10px; cursor:pointer; }
    .meter-label, .inventory-section h3 { flex:1; font-size:12px; text-align:left; }
    .meter-bar, .inventory-meter { flex:4; height:20px; background:red; position:relative; border-radius:5px; overflow:hidden; }
    .meter-fill, .inventory-fill span { height:100%; background:green; width:100%; transition: width 0.2s ease-out; }
    canvas { background:#161b22; border:2px solid #58a6ff; display:block; margin-top:10px; }
    .controls-container { display:flex; justify-content:center; align-items:center; width:90%; max-width:400px; margin-top:20px; }
    .coins { flex:1; text-align:center; font-size:16px; }
    .controls { flex:3; display:flex; gap:10px; flex-wrap:wrap; }
    button { padding:10px 20px; border:2px solid #58a6ff; background:#161b22; color:white; font-size:1rem; cursor:pointer; flex:1; min-width:100px; }
    button:hover { background:#58a6ff; color:black; border-color:#1f6feb; }
  </style>
</head>
<body>
  <div class="meters-container">
    <div class="meter"><div class="meter-label">Hunger</div><div class="meter-bar"><div class="meter-fill" id="hungerFill"></div></div></div>
    <div class="meter"><div class="meter-label">Happiness</div><div class="meter-bar"><div class="meter-fill" id="happinessFill"></div></div></div>
    <div class="meter"><div class="meter-label">Cleanliness</div><div class="meter-bar"><div class="meter-fill" id="cleanlinessFill"></div></div></div>
  </div>

  <canvas id="gameCanvas" width="400" height="400"></canvas>

  <div class="controls-container">
    <div class="coins">Coins: <span id="coinBalance">0</span></div>
    <div class="controls">
      <button id="feedBtn">Feed</button>
      <button id="playBtn">Play</button>
      <button id="cleanBtn">Clean</button>
    </div>
  </div>

  <div class="inventory">
    <div class="inventory-section" id="foodInventory"><h3>Food</h3><div class="inventory-meter"><div class="inventory-fill"><span id="foodFill"></span></div></div></div>
    <div class="inventory-section" id="toyInventory"><h3>Toys</h3><div class="inventory-meter"><div class="inventory-fill"><span id="toyFill"></span></div></div></div>
    <div class="inventory-section" id="cleaningInventory"><h3>Cleaning Supplies</h3><div class="inventory-meter"><div class="inventory-fill"><span id="cleaningFill"></span></div></div></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD2zSE_R3oQEOJST7BH0e5OAsDsPV0JzW8",
      authDomain: "wallet-18aba.firebaseapp.com",
      projectId: "wallet-18aba",
      storageBucket: "wallet-18aba.appspot.com",
      messagingSenderId: "926434300165",
      appId: "1:926434300165:web:0b5d3ba8f32de4d8cbe76c"
    };

    const app      = initializeApp(firebaseConfig);
    const auth     = getAuth(app);
    const db       = getFirestore(app);
    let currentUser= null;

    async function fetchBalance(uid) {
      const userDoc = await getDoc(doc(db, "users", uid));
      return userDoc.exists() ? userDoc.data().balance : 0;
    }

    async function updateBalance(uid, newBalance) {
      await updateDoc(doc(db, "users", uid), { balance: newBalance });
      document.getElementById("coinBalance").textContent = newBalance;
    }

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        const balance = await fetchBalance(user.uid);
        document.getElementById("coinBalance").textContent = balance;
      } else {
        alert("Login required");
      }
    });

    const tamagotchi = {
      hunger: 100,
      happiness: 100,
      cleanliness: 100,
      food: 100,
      toys: 100,
      cleaningSupplies: 100
    };

    function updateMeters() {
      document.getElementById("hungerFill").style.width = `${tamagotchi.hunger}%`;
      document.getElementById("happinessFill").style.width = `${tamagotchi.happiness}%`;
      document.getElementById("cleanlinessFill").style.width = `${tamagotchi.cleanliness}%`;
      document.getElementById("foodFill").style.width = `${tamagotchi.food}%`;
      document.getElementById("toyFill").style.width = `${tamagotchi.toys}%`;
      document.getElementById("cleaningFill").style.width = `${tamagotchi.cleaningSupplies}%`;
    }

    async function refillInventory(type) {
      if (!currentUser) return alert("Login required!");
      let balance = await fetchBalance(currentUser.uid);
      if (balance < 1) return alert("Not enough coins!");

      tamagotchi[type] = Math.min(100, tamagotchi[type] + 20);
      await updateBalance(currentUser.uid, balance - 1);
      updateMeters();
    }

    document.getElementById("foodInventory").addEventListener("click", () => refillInventory("food"));
    document.getElementById("toyInventory").addEventListener("click", () => refillInventory("toys"));
    document.getElementById("cleaningInventory").addEventListener("click", () => refillInventory("cleaningSupplies"));

    document.getElementById("feedBtn").addEventListener("click", () => {
      if (tamagotchi.food > 0) {
        tamagotchi.hunger = Math.min(100, tamagotchi.hunger + 20);
        tamagotchi.food -= 10;
        updateMeters();
      }
    });

    document.getElementById("playBtn").addEventListener("click", () => {
      if (tamagotchi.toys > 0) {
        tamagotchi.happiness = Math.min(100, tamagotchi.happiness + 20);
        tamagotchi.toys -= 10;
        updateMeters();
      }
    });

    document.getElementById("cleanBtn").addEventListener("click", () => {
      if (tamagotchi.cleaningSupplies > 0) {
        tamagotchi.cleanliness = Math.min(100, tamagotchi.cleanliness + 20);
        tamagotchi.cleaningSupplies -= 10;
        updateMeters();
      }
    });

    updateMeters();
  </script>
</body>
</html>
