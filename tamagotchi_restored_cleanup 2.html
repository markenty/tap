<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamagotchi Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0d1117;
            color: white;
        }

        canvas {
            background-color: #161b22;
            display: block;
            margin: 10px auto;
            border: 2px solid #58a6ff;
        }

        .info-section {
            text-align: center;
            margin: 10px 0;
        }

        .info-section span {
            font-size: 1.2rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin: 10px 0;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            background-color: #58a6ff;
            color: white;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        button:disabled {
            background-color: #444;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="info-section">
        <span>Coins: <span id="coinCount">Loading...</span></span>
    </div>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div class="controls">
        <button id="feedButton">Feed</button>
        <button id="playButton">Play</button>
        <button id="cleanButton">Clean</button>
    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        // Firebase Configuration
     
        const firebaseConfig = {
            apiKey: "AIzaSyD2zSE_R3oQEOJST7BH0e5OAsDsPV0JzW8",
            authDomain: "wallet-18aba.firebaseapp.com",
            projectId: "wallet-18aba",
            storageBucket: "wallet-18aba.appspot.com",
            messagingSenderId: "926434300165",
            appId: "1:926434300165:web:0b5d3ba8f32de4d8cbe76c",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM Elements
        const coinCountElement = document.getElementById("coinCount");
        const feedButton = document.getElementById("feedButton");
        const playButton = document.getElementById("playButton");
        const cleanButton = document.getElementById("cleanButton");
        const gameCanvas = document.getElementById("gameCanvas");
        const ctx = gameCanvas.getContext("2d");

        // Game State
        let userCoins = 0;
        let tamagotchi = {
            hunger: 100,
            happiness: 100,
            cleanliness: 100,
            x: 200,
            y: 200,
            alive: true
        };

        // Fetch Coin Balance
        async function fetchUserCoins(uid) {
            const userDoc = await getDoc(doc(db, "users", uid));
            if (userDoc.exists()) {
                return userDoc.data().balance;
            }
            return 0;
        }

        // Update Coin Balance
        async function updateUserCoins(uid, newBalance) {
            await updateDoc(doc(db, "users", uid), { balance: newBalance });
            userCoins = newBalance;
            coinCountElement.textContent = userCoins;
        }

        // Check Authentication State
        let currentUser = null;
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                userCoins = await fetchUserCoins(user.uid);
                coinCountElement.textContent = userCoins;
            } else {
                currentUser = null;
                coinCountElement.textContent = "Login required!";
            }
        });

        // Utility Functions
        function drawTamagotchi() {
            ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
            ctx.fillStyle = "yellow";
            ctx.beginPath();
            ctx.arc(tamagotchi.x, tamagotchi.y, 20, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = "black";
            ctx.font = "16px Arial";
            ctx.fillText("ðŸ˜Š", tamagotchi.x - 10, tamagotchi.y + 5);
        }

        function updateGameState() {
            tamagotchi.hunger -= 0.1;
            tamagotchi.happiness -= 0.05;
            tamagotchi.cleanliness -= 0.07;

            if (tamagotchi.hunger <= 0 || tamagotchi.happiness <= 0 || tamagotchi.cleanliness <= 0) {
                tamagotchi.alive = false;
            }

            drawTamagotchi();
        }

        function refillMeter(meter) {
            if (userCoins > 0) {
                tamagotchi[meter] = 100;
                userCoins -= 1;
                updateUserCoins(currentUser.uid, userCoins);
            } else {
                alert("Not enough coins!");
            }
        }

        // Event Listeners
        feedButton.addEventListener("click", () => refillMeter("hunger"));
        playButton.addEventListener("click", () => refillMeter("happiness"));
        cleanButton.addEventListener("click", () => refillMeter("cleanliness"));

        // Game Loop
        function gameLoop() {
            if (tamagotchi.alive) {
                updateGameState();
                requestAnimationFrame(gameLoop);
            } else {
                ctx.fillStyle = "red";
                ctx.font = "24px Arial";
                ctx.fillText("Game Over", gameCanvas.width / 2 - 60, gameCanvas.height / 2);
            }
        }

        gameLoop();
    </script>
</body>
</html>
